<!DOCTYPE html>
<html>
  <head>
    <title>Debug JSON Loading</title>
    <style>
      body {
        font-family: Arial;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .debug-box {
        background: white;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
        border-left: 4px solid #007bff;
      }
      .error {
        border-left-color: #dc3545;
        background: #fff5f5;
      }
      .success {
        border-left-color: #28a745;
        background: #f5fff5;
      }
      pre {
        background: #f9f9f9;
        padding: 10px;
        border-radius: 3px;
        overflow-x: auto;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
    </style>
  </head>
  <body>
    <h1>üìã Debug: JSON File Loading</h1>

    <div class="debug-box">
      <h3>Test Fetch Paths</h3>
      <button onclick="testAbsolutePath()">Test Absolute Path</button>
      <button onclick="testRelativePath()">Test Relative Path</button>
      <button onclick="testAllCourses()">Test All 6 Courses</button>
    </div>

    <div id="output"></div>

    <script>
      function log(msg, isError = false) {
        const output = document.getElementById("output");
        const div = document.createElement("div");
        div.className = "debug-box " + (isError ? "error" : "");
        div.innerHTML = `<pre>${msg}</pre>`;
        output.appendChild(div);
        console.log(msg);
      }

      async function testAbsolutePath() {
        const basePath = location.pathname.substring(
          0,
          location.pathname.lastIndexOf("/")
        );
        const courseCode = "CYS311";
        const jsonPath = `${location.origin}${basePath}/data/questions_${courseCode}.json`;

        log(`<strong>Testing Absolute Path:</strong>\n
location.origin: ${location.origin}
basePath: ${basePath}
Full path: ${jsonPath}`);

        try {
          const response = await fetch(jsonPath);
          log(
            `Fetch status: ${response.status} ${response.statusText}`,
            !response.ok
          );

          if (response.ok) {
            const data = await response.json();
            log(
              `‚úÖ Success! Questions loaded: ${data.exam.questions.length} questions`
            );
          }
        } catch (err) {
          log(`‚ùå Error: ${err.message}`, true);
        }
      }

      async function testRelativePath() {
        const courseCode = "CYS311";
        const relPath = `data/questions_${courseCode}.json`;

        log(`<strong>Testing Relative Path:</strong>\n
Path: ${relPath}`);

        try {
          const response = await fetch(relPath);
          log(
            `Fetch status: ${response.status} ${response.statusText}`,
            !response.ok
          );

          if (response.ok) {
            const data = await response.json();
            log(
              `‚úÖ Success! Questions loaded: ${data.exam.questions.length} questions`
            );
          }
        } catch (err) {
          log(`‚ùå Error: ${err.message}`, true);
        }
      }

      async function testAllCourses() {
        const courses = [
          "CYS311",
          "CYS312",
          "CYS313",
          "CYS314",
          "GNS301",
          "NCC311",
        ];

        for (const course of courses) {
          const relPath = `data/questions_${course}.json`;

          try {
            const response = await fetch(relPath);
            if (response.ok) {
              const data = await response.json();
              const count = data.exam.questions.length;
              log(`‚úÖ ${course}: ${count} questions loaded`);
            } else {
              log(`‚ùå ${course}: HTTP ${response.status}`, true);
            }
          } catch (err) {
            log(`‚ùå ${course}: ${err.message}`, true);
          }
        }
      }

      // Test on load
      window.addEventListener("DOMContentLoaded", () => {
        log(`<strong>Page Info:</strong>\n
URL: ${window.location.href}
Pathname: ${location.pathname}
Origin: ${location.origin}`);
      });
    </script>
  </body>
</html>
