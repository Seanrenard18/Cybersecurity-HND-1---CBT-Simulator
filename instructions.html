<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cybersecurity HND 1 - CBT Exam Simulator - Instructions</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <!-- Navigation Header -->
    <header class="navbar">
      <div class="navbar-container">
        <div class="logo">
          <h1>üõ°Ô∏è Cybersecurity HND 1 - CBT Exam Simulator</h1>
        </div>
        <div class="navbar-right">
          <button class="btn btn-link" id="logoutBtn">Logout</button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="instructions-container">
      <div class="instructions-wrapper">
        <!-- User Info Card -->
        <div class="user-info-card">
          <div class="user-info-header">
            <h3>Welcome, <span id="userName"></span>!</h3>
          </div>
          <div class="user-info-details">
            <p><strong>Email:</strong> <span id="userEmail"></span></p>
            <p>
              <strong>Selected Course:</strong> <span id="userSubject"></span>
            </p>
          </div>
        </div>

        <!-- Instructions Card -->
        <div class="instructions-card">
          <h2>üìã Exam Instructions</h2>

          <!-- Exam Details Section -->
          <section class="instruction-section">
            <h3>Exam Details</h3>
            <div class="details-grid">
              <div class="detail-item">
                <span class="detail-label">Total Questions:</span>
                <span class="detail-value" id="totalQuestionsDisplay">--</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Duration:</span>
                <span class="detail-value">30 minutes</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Passing Score:</span>
                <span class="detail-value">40%</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Question Type:</span>
                <span class="detail-value">Multiple Choice</span>
              </div>
            </div>
          </section>

          <!-- Quick Rules Section -->
          <section class="instruction-section">
            <h3>‚ö†Ô∏è Important Rules</h3>
            <ul class="rules-list">
              <li>
                Read questions carefully and select the most appropriate answer.
              </li>
              <li>You can change your answers before submitting the exam.</li>
              <li>Auto-submission occurs when time runs out.</li>
              <li>
                Ensure your internet connection remains stable during the exam.
              </li>
              <li>You can switch between courses and the timer will reset.</li>
            </ul>
          </section>

          <!-- Acknowledgment Section -->
          <section class="instruction-section">
            <div class="acknowledgment">
              <div class="form-group checkbox">
                <input type="checkbox" id="agreeCheckbox" name="agree" />
                <label for="agreeCheckbox" class="checkbox-label">
                  I have read and understood the instructions and rules above.
                </label>
              </div>
            </div>
          </section>

          <!-- Action Buttons -->
          <div class="action-buttons">
            <button class="btn btn-secondary" id="backBtn">
              ‚Üê Back to Login
            </button>
            <button class="btn btn-primary" id="startExamBtn" disabled>
              Start Exam ‚Üí
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <p>&copy; 2025 CBT Exam Simulator | All rights reserved</p>
    </footer>

    <!-- JavaScript -->
    <script src="js/app.js"></script>
    <script>
      // Load user data
      function loadUserData() {
        const userData = localStorage.getItem("userData");
        if (!userData) {
          window.location.href = "login.html";
          return;
        }

        const user = JSON.parse(userData);
        document.getElementById("userName").textContent = user.fullName;
        document.getElementById("userEmail").textContent = user.email;
        document.getElementById("userSubject").textContent = user.subject;

        // Load total questions dynamically
        loadTotalQuestions(user.subject);
      }

      // Load total questions for the selected course
      async function loadTotalQuestions(courseCode) {
        try {
          const basePath = location.pathname.substring(
            0,
            location.pathname.lastIndexOf("/"),
          );
          const jsonPath = `${location.origin}${basePath}/data/questions_${courseCode}.json`;

          const response = await fetch(jsonPath).catch(() =>
            fetch(`data/questions_${courseCode}.json`),
          );

          if (response.ok) {
            const data = await response.json();
            if (data.exam && data.exam.questions) {
              document.getElementById("totalQuestionsDisplay").textContent =
                data.exam.questions.length;
            }
          }
        } catch (err) {
          console.error("Could not load question count:", err);
          document.getElementById("totalQuestionsDisplay").textContent = "--";
        }
      }

      // Enable start exam button when checkbox is checked
      document
        .getElementById("agreeCheckbox")
        .addEventListener("change", function () {
          document.getElementById("startExamBtn").disabled = !this.checked;
        });

      // Start exam button handler
      document
        .getElementById("startExamBtn")
        .addEventListener("click", function () {
          const userData = JSON.parse(localStorage.getItem("userData"));
          userData.examStartTime = new Date().toISOString();
          localStorage.setItem("userData", JSON.stringify(userData));
          window.location.href = "exam.html";
        });

      // Back button handler
      document.getElementById("backBtn").addEventListener("click", function () {
        if (confirm("Are you sure? You will need to login again.")) {
          localStorage.removeItem("userData");
          window.location.href = "login.html";
        }
      });

      // Logout button handler
      document
        .getElementById("logoutBtn")
        .addEventListener("click", function () {
          if (confirm("Are you sure you want to logout?")) {
            localStorage.removeItem("userData");
            localStorage.removeItem("examAnswers");
            window.location.href = "login.html";
          }
        });

      // Initialize page
      loadUserData();
    </script>
  </body>
</html>
